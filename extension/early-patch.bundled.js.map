{
  "version": 3,
  "sources": ["../src/early-patch.ts"],
  "sourcesContent": ["/**\n * Purpose: Owns early-patch.ts runtime behavior and integration logic.\n * Docs: docs/features/feature/observe/index.md\n */\n\n// early-patch.ts \u2014 Lightweight WebSocket constructor patch.\n// Runs in MAIN world at document_start before any page scripts.\n// Saves original WebSocket and buffers connections for handoff to inject.bundled.js.\n// Must be self-contained: no imports, no chrome.* APIs (MAIN world).\n\n;(function () {\n  'use strict'\n\n  if (typeof window === 'undefined' || !window.WebSocket) return\n\n  // Guard: only install once (extension reloads, multiple frames)\n  if (window.__GASOLINE_ORIGINAL_WS__) return\n\n  const OriginalWS = window.WebSocket\n\n  // Store original for inject script to retrieve\n  window.__GASOLINE_ORIGINAL_WS__ = OriginalWS\n\n  // Buffer for early connections\n  const earlyConnections: EarlyWsConnection[] = []\n  window.__GASOLINE_EARLY_WS__ = earlyConnections\n\n  // Thin wrapper: creates real WebSocket + buffers lifecycle events\n  function EarlyWebSocket(this: unknown, url: string | URL, protocols?: string | string[]): WebSocket {\n    const ws = protocols !== undefined ? new OriginalWS(url, protocols) : new OriginalWS(url)\n    const conn: EarlyWsConnection = { ws, url: url.toString(), createdAt: Date.now(), events: [] }\n\n    ws.addEventListener('open', () => {\n      conn.events.push({ type: 'open', ts: Date.now() })\n    })\n    ws.addEventListener('close', (e: CloseEvent) => {\n      conn.events.push({ type: 'close', ts: Date.now(), code: e.code, reason: e.reason })\n    })\n    ws.addEventListener('error', () => {\n      conn.events.push({ type: 'error', ts: Date.now() })\n    })\n\n    earlyConnections.push(conn)\n\n    // Cap buffer to bound memory\n    if (earlyConnections.length > 50) {\n      earlyConnections.shift()\n    }\n\n    return ws\n  }\n\n  // Preserve prototype chain: instanceof WebSocket still works\n  EarlyWebSocket.prototype = OriginalWS.prototype\n\n  // Preserve static constants\n  Object.defineProperty(EarlyWebSocket, 'CONNECTING', { value: 0, writable: false })\n  Object.defineProperty(EarlyWebSocket, 'OPEN', { value: 1, writable: false })\n  Object.defineProperty(EarlyWebSocket, 'CLOSING', { value: 2, writable: false })\n  Object.defineProperty(EarlyWebSocket, 'CLOSED', { value: 3, writable: false })\n\n  window.WebSocket = EarlyWebSocket as unknown as typeof WebSocket\n})()\n"],
  "mappings": "oBAUE,UAAA,CACA,aAKA,GAHI,OAAO,OAAW,KAAe,CAAC,OAAO,WAGzC,OAAO,yBAA0B,OAErC,IAAMA,EAAa,OAAO,UAG1B,OAAO,yBAA2BA,EAGlC,IAAMC,EAAwC,CAAA,EAC9C,OAAO,sBAAwBA,EAG/B,SAASC,EAA8BC,EAAmBC,EAA6B,CACrF,IAAMC,EAAKD,IAAc,OAAY,IAAIJ,EAAWG,EAAKC,CAAS,EAAI,IAAIJ,EAAWG,CAAG,EAClFG,EAA0B,CAAE,GAAAD,EAAI,IAAKF,EAAI,SAAQ,EAAI,UAAW,KAAK,IAAG,EAAI,OAAQ,CAAA,CAAE,EAE5F,OAAAE,EAAG,iBAAiB,OAAQ,IAAK,CAC/BC,EAAK,OAAO,KAAK,CAAE,KAAM,OAAQ,GAAI,KAAK,IAAG,CAAE,CAAE,CACnD,CAAC,EACDD,EAAG,iBAAiB,QAAUE,GAAiB,CAC7CD,EAAK,OAAO,KAAK,CAAE,KAAM,QAAS,GAAI,KAAK,IAAG,EAAI,KAAMC,EAAE,KAAM,OAAQA,EAAE,MAAM,CAAE,CACpF,CAAC,EACDF,EAAG,iBAAiB,QAAS,IAAK,CAChCC,EAAK,OAAO,KAAK,CAAE,KAAM,QAAS,GAAI,KAAK,IAAG,CAAE,CAAE,CACpD,CAAC,EAEDL,EAAiB,KAAKK,CAAI,EAGtBL,EAAiB,OAAS,IAC5BA,EAAiB,MAAK,EAGjBI,CACT,CAGAH,EAAe,UAAYF,EAAW,UAGtC,OAAO,eAAeE,EAAgB,aAAc,CAAE,MAAO,EAAG,SAAU,EAAK,CAAE,EACjF,OAAO,eAAeA,EAAgB,OAAQ,CAAE,MAAO,EAAG,SAAU,EAAK,CAAE,EAC3E,OAAO,eAAeA,EAAgB,UAAW,CAAE,MAAO,EAAG,SAAU,EAAK,CAAE,EAC9E,OAAO,eAAeA,EAAgB,SAAU,CAAE,MAAO,EAAG,SAAU,EAAK,CAAE,EAE7E,OAAO,UAAYA,CACrB,GAAE",
  "names": ["OriginalWS", "earlyConnections", "EarlyWebSocket", "url", "protocols", "ws", "conn", "e"]
}
