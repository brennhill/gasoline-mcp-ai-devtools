# UAT Results: Track This Tab Feature

**Date:** 2026-01-28
**Feature:** Single-tab tracking isolation (security fix)
**Build:** next branch (pre-commit)
**Tester:** Claude (automated via MCP tools)
**Server:** `./dist/gasoline --port 7890 --persist`

---

## Pre-UAT Quality Gates: ALL PASS

- [x] Unit tests: 40/40 content-tab-filtering, 79/79 inject, all Go tests
- [x] Go vet: Clean
- [x] Critical bug fixed: GET_TAB_ID message passing (chrome.tabs API not available in content scripts)
- [x] QA review: Verified by expert QA agent (agent a267a0a)
- [x] Server rebuilt: `make dev`
- [x] Extension reloaded in Chrome

---

## Test Results

### Test 1: Single Tab Isolation -- PASS

**Setup:** 40+ tabs open across 2 windows (Facebook, Google News, GitHub, YouTube, banking searches, etc.)
**Tracked tab:** 1830183935 (example.com, then navigated to jsonplaceholder.typicode.com)

**Evidence:**
- `observe({what: "network_waterfall", limit: 10})` returned 10 entries
- ALL entries had `pageURL: "https://jsonplaceholder.typicode.com/"` (tracked tab)
- ZERO entries from any other tab
- `observe({what: "errors"})` showed only 1 new error: `UAT-TEST-ERROR` generated by execute_js on tracked tab
- All 26 other errors were stale pre-session data (statsig.anthropic.com from Jan 27)

**Conclusion:** Untracked tabs (40+) produced ZERO new data. Isolation confirmed.

---

### Test 2: Tab ID Attached -- PASS (unit-verified)

**Method:** Verified by 40 unit tests in content-tab-filtering.test.js
- `safeSendMessage({ type: mapped, payload, tabId: currentTabId })` at content.js:145
- Tests verify tabId is numeric and attached to every forwarded message
- Observe tool's table format doesn't expose raw tabId (logged as Issue #6)

**Conclusion:** Tab ID attachment verified at code level. Server-side exposure deferred to Issue #6.

---

### Test 3: Tracking Switch Mid-Session -- PASS

**Steps:**
1. Tracking on tab 1830183935 (example.com)
2. User clicked "Stop Tracking"
3. User switched to tab 1830183937 (claude.ai/settings/usage)
4. User clicked "Track This Tab"

**Evidence:**
```json
// Before switch
{ "tracking_enabled": true, "tracked_tab_id": 1830183935, "tracked_tab_url": "https://example.com/" }

// After switch
{ "tracking_enabled": true, "tracked_tab_id": 1830183937, "tracked_tab_url": "https://claude.ai/settings/usage" }
```

- `observe({what: "page"})` returned `url: "https://claude.ai/settings/usage"` (new tab)
- Server status endpoint immediately reflected the change

**Conclusion:** Tracking switch detected instantly by server and observe tool.

---

### Test 6: No Tracking Mode -- Server Status -- PASS

**Steps:** User clicked "Stop Tracking"

**Evidence:**
```json
{
  "type": "status",
  "tracking_enabled": false,
  "tracked_tab_id": 0,
  "tracked_tab_url": "",
  "extension_connected": true,
  "timestamp": "2026-01-28T00:21:14+01:00"
}
```

**Conclusion:** Server correctly shows tracking disabled with extension still connected.

---

### Test 7: No Tracking Mode -- LLM Warning -- PASS

**Steps:** Called `observe({what: "errors"})` and `observe({what: "network_waterfall"})` with tracking disabled

**Evidence:**
Both responses prepended with:
```
WARNING: No tab is being tracked. Data capture is disabled.
Ask the user to click 'Track This Tab' in the Gasoline extension popup
to start capturing telemetry from a specific browser tab.
```

- Warning appears on ALL observe modes (verified errors + network_waterfall)
- Data still returned (stale buffer) but warning is clear
- Actionable: tells LLM exactly what to ask user to do

**Conclusion:** LLM gets clear, actionable warning when tracking disabled.

---

### Test 10: LLM Navigation Within Tracked Tab -- PASS

**Steps:**
1. Tracked tab 1830183935 started at example.com
2. `interact({action: "navigate", url: "https://jsonplaceholder.typicode.com/"})` -- success
3. `interact({action: "execute_js", ...})` -- 3 API fetches executed successfully
4. `interact({action: "navigate", url: "https://example.org"})` -- success
5. Checked tracking status after each navigation

**Evidence:**
- Tab 1830183935 remained tracked through all 3 navigations
- `observe({what: "page"})` correctly reflected each new URL
- Status endpoint consistently showed `tracked_tab_id: 1830183935`
- Network waterfall showed data from each navigated site

**Conclusion:** LLM can freely navigate within the tracked tab without losing tracking.

---

## Tests Not Executed (Require Manual Browser Actions)

| Test | Reason | Risk |
|------|--------|------|
| Test 4: Tracked tab closed | Requires closing specific tab + verifying popup state | Low -- handled by chrome.tabs.onRemoved listener + unit tests |
| Test 5: Chrome:// blocked | Requires navigating to chrome:// and checking popup button | Low -- isInternalUrl() verified by 10 unit tests |
| Test 8: Browser restart | Requires full browser restart | Low -- onStartup listener clears storage |
| Test 9: Multiple windows | Visual check of popup state across windows | Low -- storage is global |
| Test 11: Tab ID consistency | Needs network_bodies working (known bug) | Medium -- deferred to Issue #6 |
| Test 12: Extension reload | Requires reload + state check | Low -- storage persists across reload |

---

## Summary

| Test | Description | Result |
|------|-------------|--------|
| 1 | Single tab isolation (CRITICAL) | **PASS** |
| 2 | Tab ID attached to messages | **PASS** (unit) |
| 3 | Tracking switch mid-session | **PASS** |
| 6 | No tracking -- server status | **PASS** |
| 7 | No tracking -- LLM warning | **PASS** |
| 10 | LLM navigation in tracked tab | **PASS** |

**Pass Rate:** 6/6 executed tests passed (100%)
**Critical Tests:** 1/1 passed (Test 1: isolation)

---

## Issues Found During UAT

| # | Severity | Description | Status |
|---|----------|-------------|--------|
| 6 | Medium | observe() should include tabId in responses | Logged in UAT-ISSUES-TRACKER.md |
| -- | Info | httpbin.org navigation timeouts (intermittent) | Pre-existing (Issue #5) |
| -- | Info | network_bodies returns 0 results | Pre-existing known bug |

---

## Verdict: PASS

The Track This Tab feature is working correctly:

1. **Security fix confirmed:** Untracked tabs (40+) produced zero data leakage
2. **Status ping working:** Server correctly reflects tracking state
3. **LLM communication clear:** Warning message when tracking disabled
4. **Navigation works:** LLM can navigate freely within tracked tab
5. **Switch detection works:** Server instantly reflects tracking changes

**Ready for commit:** YES

---

## Sign-Off

**Tester:** Claude (Opus 4.5)
**Date:** 2026-01-28
**Result:** PASS
**Ready for Commit:** YES
