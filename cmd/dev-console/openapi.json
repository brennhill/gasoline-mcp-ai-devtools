{
  "openapi": "3.1.0",
  "info": {
    "title": "Gasoline MCP Server",
    "description": "Browser observability for AI agents. Streams console logs, network errors, and user actions from Chrome to Claude Code, Cursor, and Copilot via MCP protocol.",
    "version": "0.7.7",
    "license": {
      "name": "MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost:{port}",
      "description": "Local Gasoline server",
      "variables": {
        "port": {
          "default": "7890",
          "description": "Server port (configurable via --port flag)"
        }
      }
    }
  ],
  "x-planes": {
    "control": "Server lifecycle, health, and protocol endpoints",
    "data-ingest": "Extension → Server telemetry ingestion (POST only)",
    "data-read": "Server → MCP client telemetry reads (GET only)",
    "data-sync": "Bidirectional extension ↔ server sync",
    "data-results": "Extension → Server query/command result submission",
    "management": "Multi-client and session management",
    "media": "Screenshot, video recording, and annotation capture",
    "ci": "CI/CD infrastructure: snapshots, buffer clear, test boundaries",
    "automation": "File and form automation (Stage 4 OS automation gated by --enable-os-upload-automation)"
  },
  "tags": [
    {
      "name": "Control",
      "description": "Server health, discovery, lifecycle, and protocol",
      "x-plane": "control"
    },
    {
      "name": "Data Ingest",
      "description": "Extension → Server telemetry ingestion (POST only)",
      "x-plane": "data-ingest"
    },
    {
      "name": "Data Read",
      "description": "Unified telemetry buffer reads",
      "x-plane": "data-read"
    },
    {
      "name": "Data Sync",
      "description": "Bidirectional extension sync",
      "x-plane": "data-sync"
    },
    {
      "name": "Data Results",
      "description": "Query/command result submission",
      "x-plane": "data-results"
    },
    {
      "name": "Management",
      "description": "Multi-client registration and session management",
      "x-plane": "management"
    },
    {
      "name": "Media",
      "description": "Screenshot, video recording, and annotation capture",
      "x-plane": "media"
    },
    {
      "name": "CI",
      "description": "CI infrastructure: snapshots, clear, test boundaries",
      "x-plane": "ci"
    },
    {
      "name": "Automation",
      "description": "Upload automation endpoints (Stage 4 requires --enable-os-upload-automation flag)",
      "x-plane": "automation"
    }
  ],
  "paths": {
    "/": {
      "get": {
        "tags": [
          "Control"
        ],
        "summary": "API discovery",
        "description": "Returns the server name, version, and links to key endpoints (/health, /logs). Serves as a lightweight discovery mechanism for MCP clients connecting to the server for the first time. Always returns 200 with a static JSON payload.",
        "operationId": "getRoot",
        "responses": {
          "200": {
            "description": "Server info with endpoint links",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DiscoveryResponse"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": [
          "Control"
        ],
        "summary": "Health check",
        "description": "Returns server health status including version, log buffer stats, and capture availability. Used by MCP clients and monitoring tools to verify the server is running and the Chrome extension is connected. The capture.available field indicates whether the extension WebSocket is active.",
        "operationId": "getHealth",
        "responses": {
          "200": {
            "description": "Server health with buffer stats and capture state",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/doctor": {
      "get": {
        "tags": [
          "Control"
        ],
        "summary": "Doctor preflight",
        "description": "Runs aggregated readiness checks for extension connectivity, pilot state, tracked tab, circuit breaker, queue pressure, and recent failure signals. Used by setup and diagnostics to determine whether interact actions are likely to succeed.",
        "operationId": "getDoctor",
        "responses": {
          "200": {
            "description": "Doctor readiness report",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": [
                        "healthy",
                        "degraded",
                        "unhealthy"
                      ],
                      "description": "Overall readiness status computed from all checks"
                    },
                    "ready_for_interaction": {
                      "type": "boolean",
                      "description": "True when interact flows are expected to succeed without warnings"
                    },
                    "version": {
                      "type": "string",
                      "description": "Server version"
                    },
                    "checks": {
                      "type": "array",
                      "description": "Per-check readiness diagnostics",
                      "items": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string",
                            "description": "Check identifier"
                          },
                          "status": {
                            "type": "string",
                            "enum": [
                              "pass",
                              "warn",
                              "fail"
                            ]
                          },
                          "detail": {
                            "type": "string",
                            "description": "Human-readable check detail"
                          },
                          "fix": {
                            "type": "string",
                            "description": "Suggested remediation when status is warn/fail"
                          }
                        },
                        "required": [
                          "name",
                          "status",
                          "detail"
                        ]
                      }
                    }
                  },
                  "required": [
                    "status",
                    "ready_for_interaction",
                    "version",
                    "checks"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/diagnostics": {
      "get": {
        "tags": [
          "Control"
        ],
        "summary": "Diagnostic report",
        "description": "Returns comprehensive diagnostic information for bug reports and troubleshooting. Includes system info (OS, arch, Go version, goroutine count), buffer counts across all ring buffers, extension connection state, and circuit breaker status. Output is designed to be copy-pasted into GitHub issues.",
        "operationId": "getDiagnostics",
        "responses": {
          "200": {
            "description": "Full diagnostic data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DiagnosticsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/diagnostics.json": {
      "get": {
        "tags": [
          "Control"
        ],
        "summary": "JSON diagnostics (alias)",
        "description": "Alias for /diagnostics that returns identical diagnostic data. Exists for explicit content-type signaling — some HTTP clients and browser URL bars prefer the .json extension to trigger JSON formatting. Handled by the same handler as /diagnostics.",
        "operationId": "getDiagnosticsJson",
        "responses": {
          "200": {
            "description": "Full diagnostic data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DiagnosticsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/shutdown": {
      "post": {
        "tags": [
          "Control"
        ],
        "summary": "Graceful shutdown",
        "description": "Initiates graceful server shutdown. Sends the JSON response first, then triggers SIGTERM after a short delay to allow the response to flush. Used by the CLI's stop command and the dashboard UI. The server closes all WebSocket connections and flushes pending writes before exiting.",
        "operationId": "postShutdown",
        "responses": {
          "200": {
            "description": "Shutdown initiated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "shutting_down",
                      "description": "Always 'shutting_down'"
                    },
                    "message": {
                      "type": "string",
                      "example": "Server shutdown initiated",
                      "description": "Human-readable confirmation"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/openapi.json": {
      "get": {
        "tags": [
          "Control"
        ],
        "summary": "OpenAPI specification",
        "description": "Serves this OpenAPI 3.1.0 specification as JSON. The spec is embedded into the Go binary at compile time via go:embed and served as-is. Used by API documentation tools, SDK generators, and the /docs page.",
        "operationId": "getOpenAPI",
        "responses": {
          "200": {
            "description": "OpenAPI 3.1.0 specification document",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "/mcp": {
      "post": {
        "tags": [
          "Control"
        ],
        "summary": "MCP JSON-RPC bridge",
        "description": "HTTP bridge for the MCP protocol. Accepts JSON-RPC 2.0 requests and routes them to the same tool handlers used by the stdio MCP transport. Supports methods: observe, generate, configure, interact, and analyze. This endpoint enables non-stdio MCP clients (dashboards, web UIs, REST wrappers) to call MCP tools over HTTP.",
        "operationId": "postMcp",
        "x-docs": {
          "core": "docs/core/async-tool-pattern.md"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/JsonRpcRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "JSON-RPC 2.0 response with result or error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JsonRpcResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/status": {
      "get": {
        "tags": [
          "Control"
        ],
        "summary": "Dashboard status feed",
        "description": "Returns aggregated server status for the built-in dashboard UI. Includes version, uptime, PID, platform, extension connection state, pilot toggle, buffer fill levels with capacities, recent command history, and optional audit metrics. Polled by the dashboard at regular intervals to keep the UI current.",
        "operationId": "getApiStatus",
        "responses": {
          "200": {
            "description": "Aggregated server status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DashboardStatus"
                }
              }
            }
          }
        }
      }
    },
    "/logs.html": {
      "get": {
        "tags": [
          "Control"
        ],
        "summary": "HTML log viewer",
        "description": "Serves the embedded HTML log viewer page. Provides a browser-based UI for viewing captured console logs with filtering and search. The HTML is embedded into the Go binary at compile time via go:embed.",
        "operationId": "getLogsHtml",
        "responses": {
          "200": {
            "description": "HTML log viewer page",
            "content": {
              "text/html": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/setup": {
      "get": {
        "tags": [
          "Control"
        ],
        "summary": "Setup page",
        "description": "Serves the embedded setup page with installation instructions and configuration guidance. Provides step-by-step instructions for connecting the Chrome extension, configuring MCP clients, and verifying the setup. The HTML is embedded into the Go binary at compile time via go:embed.",
        "operationId": "getSetup",
        "responses": {
          "200": {
            "description": "HTML setup page",
            "content": {
              "text/html": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/docs": {
      "get": {
        "tags": [
          "Control"
        ],
        "summary": "Documentation page",
        "description": "Serves the embedded documentation page with API reference and usage guides. Renders the OpenAPI spec in a human-readable format with interactive examples. The HTML is embedded into the Go binary at compile time via go:embed.",
        "operationId": "getDocs",
        "responses": {
          "200": {
            "description": "HTML documentation page",
            "content": {
              "text/html": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/logs": {
      "post": {
        "tags": [
          "Data Ingest"
        ],
        "summary": "Ingest log entries",
        "description": "Ingests console log entries from the Chrome extension. The extension's content script intercepts console.log/warn/error calls and batches them for periodic submission. Entries are stored in a ring buffer (FIFO eviction) and read by MCP clients via observe(what: 'logs'). Each entry includes level, arguments, timestamp, and source URL.",
        "operationId": "postLogs",
        "x-docs": {
          "feature": "docs/features/feature/backend-log-ingestion/"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "entries": {
                    "type": "array",
                    "description": "Array of console log entries to ingest",
                    "items": {
                      "$ref": "#/components/schemas/LogEntry"
                    }
                  }
                },
                "required": [
                  "entries"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Ingestion result with accepted/rejected counts",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LogIngestResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Data Ingest"
        ],
        "summary": "Clear log buffer",
        "description": "Clears all buffered log entries from the ring buffer. Used to reset state between test runs or when the buffer contains stale data. Does not affect the on-disk log file.",
        "operationId": "deleteLogs",
        "x-docs": {
          "feature": "docs/features/feature/backend-log-ingestion/"
        },
        "responses": {
          "200": {
            "description": "Logs cleared",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "cleared": {
                      "type": "boolean",
                      "example": true,
                      "description": "Always true on success"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/network-waterfall": {
      "post": {
        "tags": [
          "Data Ingest"
        ],
        "summary": "Ingest waterfall entries",
        "description": "Ingests network request waterfall entries (URL, status, timing) from the Chrome extension. The extension's network interceptor batches PerformanceResourceTiming entries and POSTs them periodically. Data is stored in a ring buffer (capacity 1000, FIFO eviction) and read by MCP clients via observe(what: 'network_waterfall'). Server-side analysis flags suspicious TLDs, non-standard ports, and mixed content.",
        "operationId": "postNetworkWaterfall",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "doc": "docs/features/network-capture.md"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "page_url": {
                    "type": "string",
                    "description": "URL of the page that generated these network requests"
                  },
                  "entries": {
                    "type": "array",
                    "description": "Array of network waterfall timing entries",
                    "items": {
                      "$ref": "#/components/schemas/WaterfallEntry"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Waterfall entries recorded",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IngestResponse"
                }
              }
            }
          }
        }
      }
    },
    "/network-bodies": {
      "post": {
        "tags": [
          "Data Ingest"
        ],
        "summary": "Ingest network bodies",
        "description": "Ingests network request and response bodies captured by the Chrome extension's fetch() interceptor. Bodies are stored in a ring buffer and paired with waterfall entries by URL. Binary response bodies are detected and labeled rather than stored. MCP clients read bodies via observe(what: 'network_bodies').",
        "operationId": "postNetworkBodies",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "doc": "docs/features/network-capture.md",
          "feature": "docs/features/feature/binary-format-detection/"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "bodies": {
                    "type": "array",
                    "description": "Array of captured request/response body pairs",
                    "items": {
                      "$ref": "#/components/schemas/NetworkBody"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Bodies recorded",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IngestResponse"
                }
              }
            }
          }
        }
      }
    },
    "/websocket-events": {
      "post": {
        "tags": [
          "Data Ingest"
        ],
        "summary": "Ingest WebSocket events",
        "description": "Ingests WebSocket lifecycle and message events from the Chrome extension. Captures open, message (incoming/outgoing), close, and error events with connection IDs for correlation. High-throughput connections are automatically sampled to prevent buffer flooding. Data is read by MCP clients via observe(what: 'websocket_events').",
        "operationId": "postWebSocketEvents",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "events": {
                    "type": "array",
                    "description": "Array of WebSocket events to record",
                    "items": {
                      "$ref": "#/components/schemas/WebSocketEvent"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Events recorded"
          }
        }
      }
    },
    "/telemetry": {
      "get": {
        "tags": [
          "Data Read"
        ],
        "summary": "Read telemetry buffers",
        "description": "Unified read endpoint for all telemetry buffers. Replaces individual GET endpoints on /logs, /network-waterfall, /network-bodies, /websocket-events, /enhanced-actions, /performance-snapshots. Returns the most recent N entries from the specified buffer type. This is the primary endpoint MCP clients use to read captured telemetry data.",
        "operationId": "getTelemetry",
        "parameters": [
          {
            "name": "type",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "logs",
                "network_waterfall",
                "network_bodies",
                "websocket_events",
                "actions",
                "performance_snapshots",
                "extension_logs",
                "websocket_status"
              ]
            },
            "description": "Which telemetry buffer to read. Each maps to a ring buffer maintained by the capture subsystem."
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1
            },
            "description": "Maximum entries to return. Returns the most recent N entries. Defaults to the full buffer if omitted."
          }
        ],
        "responses": {
          "200": {
            "description": "Telemetry data from the requested buffer",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TelemetryResponse"
                }
              }
            }
          },
          "400": {
            "description": "Missing or invalid type parameter"
          }
        }
      }
    },
    "/websocket-status": {
      "get": {
        "tags": [
          "Data Read"
        ],
        "summary": "Get WebSocket connection status",
        "description": "Returns active and recently-closed WebSocket connections with message rates and sampling info. Used by MCP clients via observe(what: 'websocket_status') to understand which WebSocket connections are active on the page, their throughput, and whether sampling is being applied to high-volume connections.",
        "operationId": "getWebSocketStatus",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "responses": {
          "200": {
            "description": "Active and closed WebSocket connections with throughput stats",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WebSocketStatusResponse"
                }
              }
            }
          }
        }
      }
    },
    "/enhanced-actions": {
      "post": {
        "tags": [
          "Data Ingest"
        ],
        "summary": "Ingest user actions",
        "description": "Ingests user interaction events (clicks, inputs, navigations, scrolls) from the Chrome extension. The extension's action tracker records DOM interactions with CSS selectors and values, enabling reproduction script generation and action replay. Data is stored in a ring buffer and read by MCP clients via observe(what: 'actions').",
        "operationId": "postEnhancedActions",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "actions": {
                    "type": "array",
                    "description": "Array of user interaction events to record",
                    "items": {
                      "$ref": "#/components/schemas/EnhancedAction"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Actions recorded",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IngestResponse"
                }
              }
            }
          }
        }
      }
    },
    "/performance-snapshots": {
      "post": {
        "tags": [
          "Data Ingest"
        ],
        "summary": "Ingest performance snapshots",
        "description": "Ingests Web Vitals performance snapshots (FCP, LCP, CLS, TTFB) from the Chrome extension. The extension captures Core Web Vitals using the web-vitals library and submits them on page load and navigation events. MCP clients read snapshots via observe(what: 'vitals') and compare them over time to detect performance regressions.",
        "operationId": "postPerformanceSnapshots",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/feature/web-vitals/"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "snapshots": {
                    "type": "array",
                    "description": "Array of Web Vitals snapshots to record",
                    "items": {
                      "$ref": "#/components/schemas/PerformanceSnapshot"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Snapshots recorded",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IngestResponse"
                }
              }
            }
          }
        }
      }
    },
    "/query-result": {
      "post": {
        "tags": [
          "Data Results"
        ],
        "summary": "Submit query result",
        "description": "Unified endpoint for the extension to submit results of any async query or command. Replaces the legacy separate endpoints (dom-result, a11y-result, state-result, execute-result, highlight-result). The MCP server creates a PendingQuery, delivers it to the extension via /sync, and waits for the result to arrive here. The correlation_id links the result back to the original MCP tool call.",
        "operationId": "postQueryResult",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "core": "docs/core/async-command-api.yaml"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AsyncCommandResult"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Result accepted and matched to pending query",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StatusOk"
                }
              }
            }
          }
        }
      }
    },
    "/screenshots": {
      "post": {
        "tags": [
          "Media"
        ],
        "summary": "Save screenshot",
        "description": "Saves a screenshot JPEG from the Chrome extension. The extension captures the visible tab using chrome.tabs.captureVisibleTab() and sends the base64 data URL. Screenshots are saved to the gasoline data directory and can be linked to specific MCP tool invocations via correlation_id. Rate limited to 1 screenshot per second per client to prevent disk flooding.",
        "operationId": "postScreenshot",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ScreenshotRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Screenshot saved to disk",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ScreenshotSavedResponse"
                }
              }
            }
          },
          "429": {
            "description": "Rate limited — max 1 screenshot per second per client"
          }
        }
      }
    },
    "/recordings/save": {
      "post": {
        "tags": [
          "Media"
        ],
        "summary": "Save video recording",
        "description": "Saves a tab video recording from the Chrome extension's offscreen document. The extension uses chrome.tabCapture to record the visible tab as WebM video, optionally with audio (tab audio, microphone, or both). Accepts multipart form data with the video blob and a metadata JSON string. Recordings are saved to the gasoline data directory.",
        "operationId": "postRecordingSave",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/feature/tab-recording/"
        },
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "video": {
                    "type": "string",
                    "format": "binary",
                    "description": "WebM video file blob"
                  },
                  "metadata": {
                    "type": "string",
                    "description": "JSON string conforming to VideoRecordingMetadata schema"
                  },
                  "query_id": {
                    "type": "string",
                    "description": "Pending query ID to resolve when save completes"
                  }
                },
                "required": [
                  "video",
                  "metadata"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Recording saved to disk",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RecordingSavedResponse"
                }
              }
            }
          }
        }
      }
    },
    "/clients": {
      "get": {
        "tags": [
          "Management"
        ],
        "summary": "List MCP clients",
        "description": "Lists all registered MCP clients with their working directories and last activity timestamps. MCP clients register on first connection and are tracked for multi-client coordination. The extension uses this to show connected clients in its popup UI.",
        "operationId": "getClients",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "responses": {
          "200": {
            "description": "All registered clients",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "clients": {
                      "type": "array",
                      "description": "Array of registered client records",
                      "items": {
                        "$ref": "#/components/schemas/ClientRegistration"
                      }
                    },
                    "count": {
                      "type": "integer",
                      "description": "Total number of registered clients"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Management"
        ],
        "summary": "Register MCP client",
        "description": "Registers a new MCP client with its working directory. Returns a client ID that should be included in subsequent requests via the X-Gasoline-Client header. Each client gets its own activity tracking and can be independently managed.",
        "operationId": "postClients",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "cwd": {
                    "type": "string",
                    "description": "Absolute path to the client's working directory"
                  }
                },
                "required": [
                  "cwd"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Client registered with generated ID",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "result": {
                      "$ref": "#/components/schemas/ClientRegistration"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/clients/{id}": {
      "get": {
        "tags": [
          "Management"
        ],
        "summary": "Get client details",
        "description": "Returns the registration details for a specific MCP client by ID. Includes the client's working directory, creation time, and last activity timestamp.",
        "operationId": "getClient",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Client registration ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Client registration details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ClientRegistration"
                }
              }
            }
          },
          "404": {
            "description": "Client ID not found in registry"
          }
        }
      },
      "delete": {
        "tags": [
          "Management"
        ],
        "summary": "Unregister client",
        "description": "Removes an MCP client from the registry. The client's pending queries are cancelled and its activity tracking is deleted. Used when an MCP client session ends cleanly.",
        "operationId": "deleteClient",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Client registration ID to remove"
          }
        ],
        "responses": {
          "200": {
            "description": "Client unregistered",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "unregistered": {
                      "type": "boolean",
                      "example": true,
                      "description": "Always true on success"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/sync": {
      "post": {
        "tags": [
          "Data Sync"
        ],
        "summary": "Extension sync",
        "description": "Unified bidirectional sync endpoint between the server and Chrome extension. Replaces separate polling for pending-queries, settings, extension-logs, and extension-status. In a single round-trip, the extension sends its current state (settings, logs, command results) and receives pending commands, capture overrides, and timing for the next poll. This is the primary communication channel between server and extension.",
        "operationId": "postSync",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "doc": "docs/features/sync-endpoint.md"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SyncRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Sync response with pending commands and server state",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SyncResponse"
                }
              }
            }
          }
        }
      }
    },
    "/snapshot": {
      "get": {
        "tags": [
          "CI"
        ],
        "summary": "Get capture snapshot",
        "description": "Returns an aggregated snapshot of all capture buffers for CI/testing integration. Includes logs, network bodies, WebSocket events, enhanced actions, and computed stats (error counts, warning counts, network failures). Supports filtering by timestamp (since parameter) and tagging with a test_id for correlation with test boundaries.",
        "operationId": "getSnapshot",
        "x-docs": {
          "feature": "docs/features/feature/ci-infrastructure/"
        },
        "parameters": [
          {
            "name": "since",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "Only include entries after this RFC3339Nano timestamp. Used to get a delta since the last snapshot."
          },
          {
            "name": "test_id",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Label for the snapshot, typically matching an active test boundary."
          }
        ],
        "responses": {
          "200": {
            "description": "Aggregated capture snapshot with stats",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SnapshotResponse"
                }
              }
            }
          }
        }
      }
    },
    "/clear": {
      "post": {
        "tags": [
          "CI"
        ],
        "summary": "Clear all buffers",
        "description": "Atomically resets all capture buffers (logs, network waterfall, network bodies, WebSocket events, enhanced actions, performance snapshots). Returns the total number of entries removed. Used between test runs in CI pipelines to ensure clean state, and by the MCP configure(action: 'clear') tool.",
        "operationId": "postClear",
        "x-docs": {
          "feature": "docs/features/feature/ci-infrastructure/"
        },
        "responses": {
          "200": {
            "description": "All buffers cleared",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "cleared": {
                      "type": "boolean",
                      "example": true,
                      "description": "Always true on success"
                    },
                    "entries_removed": {
                      "type": "integer",
                      "description": "Total entries removed across all buffers"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/test-boundary": {
      "post": {
        "tags": [
          "CI"
        ],
        "summary": "Mark test boundary",
        "description": "Marks the start or end of a test for correlation. While a test boundary is active, all ingested telemetry entries are tagged with the test_id, enabling per-test filtering in snapshots. Used by CI pipelines and the MCP configure(action: 'test_boundary_start/end') tool to isolate telemetry to individual test cases.",
        "operationId": "postTestBoundary",
        "x-docs": {
          "feature": "docs/features/feature/ci-infrastructure/"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TestBoundaryRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Boundary set with server timestamp",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TestBoundaryResponse"
                }
              }
            }
          }
        }
      }
    },
    "/draw-mode/complete": {
      "post": {
        "tags": [
          "Media"
        ],
        "summary": "Complete draw mode session",
        "description": "Receives annotation data and a screenshot from the extension when the user finishes a draw mode session. The user draws rectangles on the page and types feedback, then presses Escape to complete. The extension captures the annotated screenshot, DOM element details for each annotation, and sends them here. Annotations are stored per-session and retrievable via analyze(what: 'annotations').",
        "operationId": "postDrawModeComplete",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/draw-mode/"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DrawModeCompleteRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Annotations stored",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DrawModeCompleteResponse"
                }
              }
            }
          }
        }
      }
    },
    "/recordings/storage": {
      "get": {
        "tags": [
          "Media"
        ],
        "summary": "Get recording storage info",
        "description": "Returns disk usage information for saved video recordings. Lists all recordings with their file sizes, durations, and paths. Used by MCP clients via observe(what: 'saved_videos') and the dashboard to display storage consumption.",
        "operationId": "getRecordingStorage",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/feature/tab-recording/"
        },
        "responses": {
          "200": {
            "description": "Recording storage usage and file list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Media"
        ],
        "summary": "Delete recording",
        "description": "Deletes a specific video recording by ID. Removes the WebM file from disk and updates the storage index. The recording_id corresponds to the name field in VideoRecordingMetadata.",
        "operationId": "deleteRecordingStorage",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/feature/tab-recording/"
        },
        "parameters": [
          {
            "name": "recording_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Recording name/ID to delete"
          }
        ],
        "responses": {
          "200": {
            "description": "Recording file deleted from disk"
          }
        }
      },
      "post": {
        "tags": [
          "Media"
        ],
        "summary": "Recalculate recording storage",
        "description": "Triggers a full recalculation of storage usage for all saved recordings. Walks the recordings directory, recomputes file sizes, and updates the storage index. Used after manual file operations or to recover from index drift.",
        "operationId": "postRecordingStorage",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/feature/tab-recording/"
        },
        "responses": {
          "200": {
            "description": "Storage index recalculated"
          }
        }
      }
    },
    "/recordings/reveal": {
      "post": {
        "tags": [
          "Media"
        ],
        "summary": "Reveal recording in file manager",
        "description": "Opens the recording file location in the system file manager (Finder on macOS, Explorer on Windows, xdg-open on Linux). Used by MCP clients and the dashboard to let users access recorded video files directly.",
        "operationId": "postRecordingReveal",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/feature/tab-recording/"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "path": {
                    "type": "string",
                    "description": "Absolute path to the recording file to reveal"
                  }
                },
                "required": [
                  "path"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File revealed in system file manager",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "revealed",
                      "description": "Always 'revealed' on success"
                    },
                    "path": {
                      "type": "string",
                      "description": "Echo of the file path that was revealed"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/file/read": {
      "post": {
        "tags": [
          "Automation"
        ],
        "summary": "Read file for upload",
        "description": "Reads a local file and returns its contents as base64 for upload automation (Stage 1). Always available without the --enable-os-upload-automation flag. Validates file existence, computes MIME type from extension, and enforces size limits. Used by the MCP interact(action: 'upload') tool as the first step in the multi-stage upload pipeline.",
        "operationId": "postFileRead",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/file-upload/"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "file_path": {
                    "type": "string",
                    "description": "Absolute path to the file to read"
                  }
                },
                "required": [
                  "file_path"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File data with base64 contents",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FileReadResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/file/dialog/inject": {
      "post": {
        "tags": [
          "Automation"
        ],
        "summary": "Inject file into dialog",
        "description": "Injects a file path into a native file dialog using Chrome DevTools Protocol (Stage 2). Always available without the --enable-os-upload-automation flag. Intercepts the file chooser dialog opened by an <input type='file'> element and programmatically sets the file. Requires the browser PID to identify the correct Chrome instance.",
        "operationId": "postFileDialogInject",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/file-upload/"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "file_path": {
                    "type": "string",
                    "description": "Absolute path to the file to inject"
                  },
                  "browser_pid": {
                    "type": "integer",
                    "description": "Chrome browser process ID for DevTools connection"
                  }
                },
                "required": [
                  "file_path",
                  "browser_pid"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File dialog injection result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UploadStageResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/form/submit": {
      "post": {
        "tags": [
          "Automation"
        ],
        "summary": "Submit form with file",
        "description": "Submits an HTML form with a file upload via server-side multipart POST (Stage 3). Always available without the --enable-os-upload-automation flag. Constructs a multipart/form-data request with the specified file and form fields, including optional CSRF token and cookies. Used when CDP file dialog injection (Stage 2) is not possible.",
        "operationId": "postFormSubmit",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/file-upload/"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FormSubmitRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Form submission result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UploadStageResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/os-automation/inject": {
      "post": {
        "tags": [
          "Automation"
        ],
        "summary": "OS-level file dialog injection",
        "description": "Uses OS-level automation (AppleScript on macOS, xdotool on Linux) to inject a file path into a native file dialog (Stage 4). Requires the --enable-os-upload-automation flag. This is the fallback stage when CDP injection (Stage 2) fails, typically for non-standard file dialogs. Supports retry logic for timing-sensitive dialog interactions.",
        "operationId": "postOSAutomationInject",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/file-upload/"
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "file_path": {
                    "type": "string",
                    "description": "Absolute path to the file to inject"
                  },
                  "browser_pid": {
                    "type": "integer",
                    "description": "Chrome browser process ID"
                  },
                  "retry_count": {
                    "type": "integer",
                    "description": "Number of retry attempts for dialog detection (default: 3)"
                  }
                },
                "required": [
                  "file_path",
                  "browser_pid"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OS automation injection result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UploadStageResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/os-automation/dismiss": {
      "post": {
        "tags": [
          "Automation"
        ],
        "summary": "Dismiss native file dialog",
        "description": "Sends Escape key via OS automation to close a dangling native file dialog after a failed upload automation attempt (Stage 4 cleanup). Requires --enable-os-upload-automation flag. Prevents orphaned dialog windows from blocking the browser after upload failures.",
        "operationId": "postOSAutomationDismiss",
        "security": [
          {
            "extensionClient": []
          }
        ],
        "x-docs": {
          "feature": "docs/features/file-upload/"
        },
        "responses": {
          "200": {
            "description": "Dialog dismissed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UploadStageResponse"
                }
              }
            }
          },
          "403": {
            "description": "OS automation is disabled (--enable-os-upload-automation flag not set)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UploadStageResponse"
                }
              }
            }
          }
        }
      }
    },
    "/insecure-proxy": {
      "get": {
        "tags": [
          "Control"
        ],
        "summary": "Insecure proxy (altered environment)",
        "description": "Last-resort altered-environment debugging proxy for CSP-locked pages. Only available when security_mode is insecure_proxy. Fetches a target URL and strips CSP response headers; output is not production parity.",
        "operationId": "getInsecureProxy",
        "parameters": [
          {
            "name": "target",
            "in": "query",
            "required": true,
            "description": "Absolute http/https URL to fetch through the proxy.",
            "schema": {
              "type": "string",
              "format": "uri"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Upstream response body proxied with CSP headers removed.",
            "content": {
              "text/html": {
                "schema": {
                  "type": "string"
                }
              },
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "400": {
            "description": "Missing or invalid target URL.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Insecure proxy mode is disabled.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "502": {
            "description": "Failed to fetch upstream URL.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "extensionClient": {
        "type": "apiKey",
        "in": "header",
        "name": "X-Gasoline-Client",
        "description": "Extension client identifier. Must match pattern 'gasoline-extension-*'. Required for extension-only endpoints."
      }
    },
    "schemas": {
      "StatusOk": {
        "type": "object",
        "description": "Standard success response returned by endpoints that have no meaningful payload. Contains a single 'ok' status field.",
        "properties": {
          "status": {
            "type": "string",
            "example": "ok",
            "description": "Always 'ok' on success"
          }
        }
      },
      "IngestResponse": {
        "type": "object",
        "description": "Standard response from telemetry ingestion endpoints (network-waterfall, network-bodies, enhanced-actions, performance-snapshots). Confirms the number of entries recorded into the ring buffer.",
        "properties": {
          "status": {
            "type": "string",
            "example": "ok",
            "description": "Always 'ok' on success"
          },
          "count": {
            "type": "integer",
            "description": "Number of entries recorded"
          }
        }
      },
      "DiscoveryResponse": {
        "type": "object",
        "description": "API discovery payload returned by GET /. Provides server identity and links to key endpoints for first-time client bootstrapping.",
        "properties": {
          "name": {
            "type": "string",
            "example": "gasoline",
            "description": "Server identifier"
          },
          "version": {
            "type": "string",
            "example": "0.7.7",
            "description": "Server version string"
          },
          "health": {
            "type": "string",
            "example": "/health",
            "description": "Link to health check endpoint"
          },
          "logs": {
            "type": "string",
            "example": "/logs",
            "description": "Link to log ingestion endpoint"
          }
        }
      },
      "LogIngestResponse": {
        "type": "object",
        "description": "Response from POST /logs with counts of received, rejected, and total buffered entries. Rejected entries are malformed or filtered by noise rules.",
        "properties": {
          "received": {
            "type": "integer",
            "description": "Number of entries received in the request"
          },
          "rejected": {
            "type": "integer",
            "description": "Number of entries rejected (malformed or filtered)"
          },
          "entries": {
            "type": "integer",
            "description": "Total entries now in the buffer"
          }
        }
      },
      "TelemetryResponse": {
        "type": "object",
        "description": "Unified telemetry read response from GET /telemetry. Returns entries from the requested buffer type with a count. The items array shape depends on the type parameter.",
        "properties": {
          "type": {
            "type": "string",
            "description": "Echo of the requested buffer type"
          },
          "items": {
            "type": "array",
            "description": "Array of telemetry entries (shape depends on type)"
          },
          "count": {
            "type": "integer",
            "description": "Number of entries returned"
          }
        }
      },
      "DashboardStatus": {
        "type": "object",
        "description": "Aggregated server status for the built-in dashboard UI. Polled at regular intervals to keep the dashboard current with server state, buffer fill levels, and extension connectivity.",
        "properties": {
          "version": {
            "type": "string",
            "description": "Server version string"
          },
          "uptime_seconds": {
            "type": "integer",
            "description": "Seconds since server started"
          },
          "pid": {
            "type": "integer",
            "description": "Server process ID"
          },
          "platform": {
            "type": "string",
            "description": "OS and architecture (e.g. 'darwin/arm64')"
          },
          "extension_connected": {
            "type": "boolean",
            "description": "Whether the Chrome extension WebSocket is active"
          },
          "pilot_enabled": {
            "type": "boolean",
            "description": "Whether AI Web Pilot is enabled in the extension"
          },
          "last_poll_at": {
            "type": "string",
            "format": "date-time",
            "description": "RFC3339 timestamp of the extension's last /sync poll"
          },
          "buffers": {
            "type": "object",
            "description": "Ring buffer fill levels and capacities",
            "properties": {
              "console_entries": {
                "type": "integer",
                "description": "Current console log buffer entries"
              },
              "console_capacity": {
                "type": "integer",
                "description": "Console log buffer max capacity"
              },
              "network_entries": {
                "type": "integer",
                "description": "Current network body buffer entries"
              },
              "network_capacity": {
                "type": "integer",
                "description": "Network body buffer max capacity"
              },
              "websocket_entries": {
                "type": "integer",
                "description": "Current WebSocket event buffer entries"
              },
              "websocket_capacity": {
                "type": "integer",
                "description": "WebSocket event buffer max capacity"
              },
              "action_entries": {
                "type": "integer",
                "description": "Current user action buffer entries"
              },
              "action_capacity": {
                "type": "integer",
                "description": "User action buffer max capacity"
              }
            }
          },
          "recent_commands": {
            "type": "array",
            "items": {
              "type": "object"
            },
            "description": "Recent MCP commands from the HTTP debug log"
          },
          "audit": {
            "type": "object",
            "description": "Tool health metrics and audit info (present when MCP handler is active)"
          }
        }
      },
      "ScreenshotRequest": {
        "type": "object",
        "description": "Screenshot upload request from the Chrome extension. Contains the base64 image data and optional correlation metadata for linking to MCP tool invocations.",
        "properties": {
          "data_url": {
            "type": "string",
            "description": "Base64 data URL (data:image/jpeg;base64,...)"
          },
          "url": {
            "type": "string",
            "description": "Page URL where the screenshot was taken"
          },
          "correlation_id": {
            "type": "string",
            "description": "Links this screenshot to an MCP tool invocation"
          },
          "query_id": {
            "type": "string",
            "description": "Pending query ID for on-demand screenshot flow"
          }
        },
        "required": [
          "data_url"
        ]
      },
      "ScreenshotSavedResponse": {
        "type": "object",
        "description": "Confirmation that a screenshot was saved to disk. Returns the generated filename and absolute path for the MCP client to reference.",
        "properties": {
          "filename": {
            "type": "string",
            "description": "Generated filename for the saved screenshot"
          },
          "path": {
            "type": "string",
            "description": "Absolute file path where the screenshot was saved"
          },
          "correlation_id": {
            "type": "string",
            "description": "Echo of the correlation_id if provided"
          }
        }
      },
      "RecordingSavedResponse": {
        "type": "object",
        "description": "Confirmation that a video recording was saved to disk. Returns the recording name, path, and file size.",
        "x-docs": {
          "feature": "docs/features/feature/tab-recording/"
        },
        "properties": {
          "status": {
            "type": "string",
            "example": "saved",
            "description": "Always 'saved' on success"
          },
          "name": {
            "type": "string",
            "description": "Recording name from metadata"
          },
          "path": {
            "type": "string",
            "description": "Absolute file path where the recording was saved"
          },
          "size": {
            "type": "integer",
            "format": "int64",
            "description": "File size in bytes"
          }
        }
      },
      "TestBoundaryRequest": {
        "type": "object",
        "description": "Request to start or end a test boundary for telemetry correlation. While active, all ingested entries are tagged with the test_id.",
        "x-docs": {
          "feature": "docs/features/feature/ci-infrastructure/"
        },
        "properties": {
          "test_id": {
            "type": "string",
            "description": "Unique identifier for the test run"
          },
          "action": {
            "type": "string",
            "enum": [
              "start",
              "end"
            ],
            "description": "Whether to start or end the test boundary"
          }
        },
        "required": [
          "test_id",
          "action"
        ]
      },
      "TestBoundaryResponse": {
        "type": "object",
        "description": "Confirmation that a test boundary was set, with the server timestamp for synchronization.",
        "x-docs": {
          "feature": "docs/features/feature/ci-infrastructure/"
        },
        "properties": {
          "test_id": {
            "type": "string",
            "description": "Echo of the test_id"
          },
          "action": {
            "type": "string",
            "description": "Echo of the action (start/end)"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Server timestamp when the boundary was set"
          }
        }
      },
      "DrawModeCompleteRequest": {
        "type": "object",
        "description": "Annotation data from a completed draw mode session. Contains the annotated screenshot, rectangle annotations with user feedback, and computed DOM element details for each annotated region.",
        "x-docs": {
          "feature": "docs/features/draw-mode/"
        },
        "properties": {
          "screenshot_data_url": {
            "type": "string",
            "description": "Base64 data URL of the annotated screenshot"
          },
          "annotations": {
            "type": "array",
            "items": {
              "type": "object"
            },
            "description": "Annotation rectangles with user-typed feedback text"
          },
          "element_details": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            },
            "description": "Map of annotation correlation_id to computed DOM element details (tag, classes, styles, dimensions)"
          },
          "page_url": {
            "type": "string",
            "description": "URL of the page where annotations were drawn"
          },
          "tab_id": {
            "type": "integer",
            "description": "Chrome tab ID where draw mode was active"
          },
          "annot_session_name": {
            "type": "string",
            "description": "Named session for multi-page annotation accumulation"
          }
        },
        "required": [
          "tab_id"
        ]
      },
      "DrawModeCompleteResponse": {
        "type": "object",
        "description": "Confirmation that draw mode annotations were stored. Includes the screenshot save path and any parse warnings for malformed annotations.",
        "x-docs": {
          "feature": "docs/features/draw-mode/"
        },
        "properties": {
          "status": {
            "type": "string",
            "example": "stored",
            "description": "Always 'stored' on success"
          },
          "annotation_count": {
            "type": "integer",
            "description": "Number of annotations received"
          },
          "screenshot": {
            "type": "string",
            "description": "File path where the annotated screenshot was saved"
          },
          "warnings": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Parse warnings for malformed or skipped annotations"
          }
        }
      },
      "FileReadResponse": {
        "type": "object",
        "description": "Result of reading a local file for upload automation (Stage 1). Contains the file's base64 contents, detected MIME type, and size. On failure, success is false and error contains the reason.",
        "x-docs": {
          "feature": "docs/features/file-upload/"
        },
        "properties": {
          "success": {
            "type": "boolean",
            "description": "Whether the file was read successfully"
          },
          "file_name": {
            "type": "string",
            "description": "Base name of the file"
          },
          "file_size": {
            "type": "integer",
            "format": "int64",
            "description": "File size in bytes"
          },
          "mime_type": {
            "type": "string",
            "description": "Detected MIME type based on file extension"
          },
          "data_base64": {
            "type": "string",
            "description": "Base64-encoded file contents"
          },
          "error": {
            "type": "string",
            "description": "Error message if success is false"
          }
        }
      },
      "FormSubmitRequest": {
        "type": "object",
        "description": "Request to submit an HTML form with a file upload via server-side multipart POST (Stage 3). Includes the form action URL, file details, and optional authentication fields.",
        "x-docs": {
          "feature": "docs/features/file-upload/"
        },
        "properties": {
          "form_action": {
            "type": "string",
            "description": "URL to submit the form to (action attribute)"
          },
          "method": {
            "type": "string",
            "description": "HTTP method (defaults to POST)"
          },
          "fields": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            },
            "description": "Key-value pairs for non-file form fields"
          },
          "file_input_name": {
            "type": "string",
            "description": "Name attribute of the file input field"
          },
          "file_path": {
            "type": "string",
            "description": "Absolute path to the file to upload"
          },
          "csrf_token": {
            "type": "string",
            "description": "CSRF token value to include in the form submission"
          },
          "cookies": {
            "type": "string",
            "description": "Cookie header string for authenticated submissions"
          }
        },
        "required": [
          "form_action",
          "file_input_name",
          "file_path"
        ]
      },
      "HealthResponse": {
        "type": "object",
        "description": "Server health status returned by GET /health. Provides version info, log buffer stats, and capture subsystem availability. Used by MCP clients to verify server readiness and extension connectivity.",
        "properties": {
          "status": {
            "type": "string",
            "example": "ok",
            "description": "Server status ('ok' when healthy)"
          },
          "version": {
            "type": "string",
            "description": "Server version string"
          },
          "available_version": {
            "type": "string",
            "description": "Latest available version from npm registry (if version check is enabled)"
          },
          "logs": {
            "type": "object",
            "description": "Console log buffer statistics",
            "properties": {
              "entries": {
                "type": "integer",
                "description": "Current number of log entries in the ring buffer"
              },
              "max_entries": {
                "type": "integer",
                "description": "Maximum ring buffer capacity"
              },
              "log_file": {
                "type": "string",
                "description": "Path to the on-disk log file"
              },
              "log_file_size": {
                "type": "integer",
                "format": "int64",
                "description": "Size of the on-disk log file in bytes"
              },
              "dropped_count": {
                "type": "integer",
                "format": "int64",
                "description": "Total log entries dropped due to buffer overflow (FIFO eviction)"
              }
            }
          },
          "capture": {
            "type": "object",
            "description": "Capture subsystem availability",
            "properties": {
              "available": {
                "type": "boolean",
                "description": "Whether the Chrome extension WebSocket connection is active"
              },
              "pilot_enabled": {
                "type": "boolean",
                "description": "Whether AI Web Pilot is enabled in the extension settings"
              }
            }
          }
        }
      },
      "DiagnosticsResponse": {
        "type": "object",
        "description": "Comprehensive diagnostic report for bug reports and troubleshooting. Includes system info, buffer fill levels, and extension state. Designed to be copy-pasted into GitHub issues.",
        "properties": {
          "generated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when this diagnostic report was generated"
          },
          "version": {
            "type": "string",
            "description": "Server version string"
          },
          "uptime_seconds": {
            "type": "integer",
            "description": "Seconds since server started"
          },
          "system": {
            "type": "object",
            "description": "Host system information",
            "properties": {
              "os": {
                "type": "string",
                "description": "Operating system (e.g. 'darwin', 'linux', 'windows')"
              },
              "arch": {
                "type": "string",
                "description": "CPU architecture (e.g. 'arm64', 'amd64')"
              },
              "go_version": {
                "type": "string",
                "description": "Go runtime version used to build the server"
              },
              "goroutines": {
                "type": "integer",
                "description": "Number of active goroutines"
              }
            }
          },
          "logs": {
            "type": "object",
            "description": "Console log buffer status",
            "properties": {
              "entries": {
                "type": "integer",
                "description": "Current entries in the log ring buffer"
              },
              "max_entries": {
                "type": "integer",
                "description": "Maximum log ring buffer capacity"
              },
              "log_file": {
                "type": "string",
                "description": "Path to the on-disk log file"
              }
            }
          },
          "buffers": {
            "type": "object",
            "description": "Fill levels for all capture ring buffers",
            "properties": {
              "websocket_events": {
                "type": "integer",
                "description": "Current WebSocket event buffer entries"
              },
              "network_bodies": {
                "type": "integer",
                "description": "Current network body buffer entries"
              },
              "actions": {
                "type": "integer",
                "description": "Current user action buffer entries"
              },
              "pending_queries": {
                "type": "integer",
                "description": "Number of queries awaiting extension response"
              },
              "query_results": {
                "type": "integer",
                "description": "Number of undelivered query results"
              }
            }
          }
        }
      },
      "JsonRpcRequest": {
        "type": "object",
        "description": "JSON-RPC 2.0 request envelope for the /mcp HTTP bridge. Wraps MCP tool calls (observe, generate, configure, interact, analyze) for HTTP transport.",
        "required": [
          "jsonrpc",
          "method"
        ],
        "properties": {
          "jsonrpc": {
            "type": "string",
            "enum": [
              "2.0"
            ],
            "description": "JSON-RPC protocol version (must be '2.0')"
          },
          "id": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "integer"
              }
            ],
            "description": "Request ID for response correlation"
          },
          "method": {
            "type": "string",
            "enum": [
              "observe",
              "generate",
              "configure",
              "interact",
              "analyze"
            ],
            "description": "MCP tool name to invoke"
          },
          "params": {
            "type": "object",
            "description": "Tool-specific parameters (same as MCP tool input schema)"
          }
        }
      },
      "JsonRpcResponse": {
        "type": "object",
        "description": "JSON-RPC 2.0 response envelope from the /mcp HTTP bridge. Contains either a result object or an error object, never both.",
        "properties": {
          "jsonrpc": {
            "type": "string",
            "enum": [
              "2.0"
            ],
            "description": "JSON-RPC protocol version (always '2.0')"
          },
          "id": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "integer"
              }
            ],
            "description": "Echo of the request ID"
          },
          "result": {
            "type": "object",
            "description": "Tool result on success (absent on error)"
          },
          "error": {
            "type": "object",
            "description": "Error details on failure (absent on success)",
            "properties": {
              "code": {
                "type": "integer",
                "description": "JSON-RPC error code (-32600 to -32603 for protocol errors)"
              },
              "message": {
                "type": "string",
                "description": "Human-readable error message"
              }
            }
          }
        }
      },
      "LogEntry": {
        "type": "object",
        "description": "Console log entry captured from the browser. Represents a single console.log/warn/error/info/debug call with its arguments and metadata.",
        "properties": {
          "level": {
            "type": "string",
            "enum": [
              "error",
              "warn",
              "info",
              "debug",
              "log"
            ],
            "description": "Console log level"
          },
          "args": {
            "description": "Serialized console arguments (strings, objects, arrays)"
          },
          "ts": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the log was captured in the browser"
          },
          "url": {
            "type": "string",
            "description": "Page URL where the console call originated"
          }
        },
        "required": [
          "level"
        ]
      },
      "WaterfallEntry": {
        "type": "object",
        "description": "Network request timing entry derived from PerformanceResourceTiming. Captures URL, HTTP status, and duration for waterfall visualization and performance analysis.",
        "x-docs": {
          "doc": "docs/features/network-capture.md"
        },
        "properties": {
          "url": {
            "type": "string",
            "description": "Request URL"
          },
          "status": {
            "type": "integer",
            "description": "HTTP response status code"
          },
          "statusText": {
            "type": "string",
            "description": "HTTP response status text"
          },
          "timing": {
            "type": "number",
            "description": "Total request duration in milliseconds"
          }
        }
      },
      "NetworkBody": {
        "type": "object",
        "description": "Captured request and response body pair from a fetch() call. The extension intercepts fetch requests and clones response bodies for inspection. Binary content is detected and labeled rather than stored in full.",
        "x-docs": {
          "doc": "docs/features/network-capture.md",
          "feature": "docs/features/feature/binary-format-detection/"
        },
        "properties": {
          "url": {
            "type": "string",
            "description": "Request URL"
          },
          "method": {
            "type": "string",
            "description": "HTTP method (GET, POST, PUT, etc.)"
          },
          "status": {
            "type": "integer",
            "description": "HTTP response status code"
          },
          "request_body": {
            "type": "string",
            "description": "Serialized request body (JSON stringified for objects)"
          },
          "response_body": {
            "type": "string",
            "description": "Serialized response body (truncated if over size limit, labeled if binary)"
          }
        }
      },
      "WebSocketEvent": {
        "type": "object",
        "description": "WebSocket lifecycle or message event. Captures connection open/close, incoming/outgoing messages, and errors. Events are grouped by connection ID for correlation.",
        "properties": {
          "id": {
            "type": "string",
            "description": "Connection ID — stable across all events for a single WebSocket connection"
          },
          "url": {
            "type": "string",
            "description": "WebSocket URL (ws:// or wss://)"
          },
          "event": {
            "type": "string",
            "enum": [
              "open",
              "message",
              "close",
              "error"
            ],
            "description": "Event type"
          },
          "direction": {
            "type": "string",
            "enum": [
              "incoming",
              "outgoing"
            ],
            "description": "Message direction (only present for 'message' events)"
          },
          "data": {
            "type": "string",
            "description": "Message payload (truncated if over size limit)"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Event timestamp"
          },
          "size": {
            "type": "integer",
            "description": "Message payload size in bytes"
          }
        }
      },
      "WebSocketStatusResponse": {
        "type": "object",
        "description": "Overview of active and recently-closed WebSocket connections. Includes message rates and sampling info for each connection, used to identify high-throughput connections and sampling behavior.",
        "properties": {
          "connections": {
            "type": "array",
            "description": "Currently active WebSocket connections",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "description": "Connection ID"
                },
                "url": {
                  "type": "string",
                  "description": "WebSocket URL"
                },
                "state": {
                  "type": "string",
                  "description": "Connection state (e.g. 'open')"
                },
                "opened_at": {
                  "type": "string",
                  "format": "date-time",
                  "description": "When the connection was opened"
                },
                "duration": {
                  "type": "string",
                  "description": "Human-readable connection duration"
                },
                "message_rate": {
                  "type": "object",
                  "description": "Messages per second statistics"
                },
                "sampling": {
                  "type": "object",
                  "description": "Sampling configuration if applied to this connection"
                }
              }
            }
          },
          "closed": {
            "type": "array",
            "description": "Recently closed WebSocket connections (kept for short-term history)",
            "items": {
              "type": "object"
            }
          }
        }
      },
      "EnhancedAction": {
        "type": "object",
        "description": "User interaction event captured from the browser. Records clicks, inputs, navigations, and scrolls with CSS selectors for reproduction script generation and action replay.",
        "properties": {
          "action": {
            "type": "string",
            "description": "Action type (e.g. 'click', 'input', 'navigate', 'scroll')"
          },
          "selector": {
            "type": "string",
            "description": "CSS selector for the target DOM element"
          },
          "value": {
            "type": "string",
            "description": "Value associated with the action (input text, scroll position, URL)"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When the action occurred"
          }
        }
      },
      "PerformanceSnapshot": {
        "type": "object",
        "description": "Core Web Vitals performance snapshot captured from the browser. Contains FCP, LCP, CLS, and TTFB metrics measured by the web-vitals library on page load and navigation events.",
        "x-docs": {
          "feature": "docs/features/feature/web-vitals/"
        },
        "properties": {
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When the snapshot was captured"
          },
          "fcp": {
            "type": "number",
            "description": "First Contentful Paint in milliseconds"
          },
          "lcp": {
            "type": "number",
            "description": "Largest Contentful Paint in milliseconds"
          },
          "cls": {
            "type": "number",
            "description": "Cumulative Layout Shift score (unitless, lower is better)"
          },
          "ttfb": {
            "type": "number",
            "description": "Time to First Byte in milliseconds"
          }
        }
      },
      "PendingQuery": {
        "type": "object",
        "description": "A command queued for execution by the Chrome extension. Created by MCP tool handlers and delivered to the extension via the /sync endpoint. The extension executes the command and returns results via /query-result or the sync response's command_results field.",
        "x-docs": {
          "core": "docs/core/async-command-api.yaml"
        },
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique query ID for matching results to requests"
          },
          "type": {
            "type": "string",
            "description": "Command type that determines which extension handler processes this query",
            "enum": [
              "dom",
              "a11y",
              "execute",
              "highlight",
              "state",
              "record_start",
              "record_stop",
              "browser_action",
              "page_info",
              "tabs",
              "subtitle",
              "screenshot",
              "dom_action",
              "state_capture",
              "state_save",
              "state_load",
              "state_list",
              "state_delete"
            ]
          },
          "params": {
            "type": "object",
            "description": "Command-specific parameters passed to the extension handler"
          },
          "correlation_id": {
            "type": "string",
            "description": "Links this query to the originating MCP tool call for result routing"
          }
        }
      },
      "QueryResult": {
        "type": "object",
        "description": "Legacy query result format. Used internally when processing results from the extension. Newer code uses AsyncCommandResult or SyncCommandResult instead.",
        "properties": {
          "id": {
            "type": "string",
            "description": "Query ID matching the original PendingQuery"
          },
          "result": {
            "description": "Query result data (shape depends on query type)"
          },
          "client_id": {
            "type": "string",
            "description": "ID of the extension client that produced this result"
          }
        },
        "required": [
          "id"
        ]
      },
      "AsyncCommandResult": {
        "type": "object",
        "description": "Result of an async command submitted by the extension via POST /query-result. Contains either a successful result or an error. The id field matches the original PendingQuery, and correlation_id links back to the MCP tool invocation.",
        "x-docs": {
          "core": "docs/core/async-command-api.yaml"
        },
        "properties": {
          "id": {
            "type": "string",
            "description": "Query ID matching the original PendingQuery"
          },
          "correlation_id": {
            "type": "string",
            "description": "Links back to the originating MCP tool call"
          },
          "status": {
            "type": "string",
            "enum": [
              "complete",
              "error",
              "timeout"
            ],
            "description": "Execution outcome"
          },
          "result": {
            "description": "Command result data on success (shape depends on command type)"
          },
          "error": {
            "type": "string",
            "description": "Error message when status is 'error'"
          },
          "client_id": {
            "type": "string",
            "description": "ID of the extension client that executed this command"
          }
        }
      },
      "VideoRecordingMetadata": {
        "type": "object",
        "description": "Metadata for a saved video recording. Accompanies the WebM video file in the multipart upload to /recordings/save. Describes the recording's source, format, duration, and audio configuration.",
        "x-docs": {
          "feature": "docs/features/feature/tab-recording/"
        },
        "properties": {
          "name": {
            "type": "string",
            "description": "Unique recording identifier used as the filename stem"
          },
          "display_name": {
            "type": "string",
            "description": "Human-readable recording name shown in UI"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "When the recording was started"
          },
          "duration_seconds": {
            "type": "integer",
            "description": "Recording duration in seconds"
          },
          "size_bytes": {
            "type": "integer",
            "format": "int64",
            "description": "Video file size in bytes"
          },
          "url": {
            "type": "string",
            "description": "Page URL that was being recorded"
          },
          "tab_id": {
            "type": "integer",
            "description": "Chrome tab ID that was recorded"
          },
          "resolution": {
            "type": "string",
            "example": "1920x1080",
            "description": "Video resolution as WxH"
          },
          "format": {
            "type": "string",
            "description": "Video format (e.g. 'webm')"
          },
          "fps": {
            "type": "integer",
            "description": "Frames per second"
          },
          "has_audio": {
            "type": "boolean",
            "description": "Whether the recording includes audio"
          },
          "audio_mode": {
            "type": "string",
            "enum": [
              "tab",
              "mic",
              "both"
            ],
            "description": "Audio source: tab audio, microphone, or both"
          },
          "truncated": {
            "type": "boolean",
            "description": "Whether the recording was truncated due to size or duration limits"
          }
        },
        "required": [
          "name"
        ]
      },
      "ClientRegistration": {
        "type": "object",
        "description": "MCP client registration record. Created when an MCP client connects and registers via POST /clients. Tracks the client's working directory and activity for multi-client coordination.",
        "properties": {
          "id": {
            "type": "string",
            "description": "Auto-generated unique client ID"
          },
          "cwd": {
            "type": "string",
            "description": "Client's working directory (absolute path)"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "When the client was first registered"
          },
          "last_activity": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp of the client's most recent API call"
          }
        }
      },
      "SyncRequest": {
        "type": "object",
        "description": "Extension-to-server sync payload. The Chrome extension sends its current state on each poll interval. Contains settings, internal logs, and results from async commands. This is the upstream half of the bidirectional sync protocol.",
        "x-docs": {
          "doc": "docs/features/sync-endpoint.md"
        },
        "properties": {
          "session_id": {
            "type": "string",
            "description": "Extension session identifier for reconnection tracking"
          },
          "extension_version": {
            "type": "string",
            "description": "Chrome extension version string"
          },
          "settings": {
            "type": "object",
            "description": "Current extension settings and tracking state",
            "properties": {
              "pilot_enabled": {
                "type": "boolean",
                "description": "Whether AI Web Pilot is enabled"
              },
              "tracking_enabled": {
                "type": "boolean",
                "description": "Whether the extension is actively tracking a tab"
              },
              "tracked_tab_id": {
                "type": "integer",
                "description": "Chrome tab ID being tracked (0 if none)"
              },
              "tracked_tab_url": {
                "type": "string",
                "description": "URL of the tracked tab"
              },
              "tracked_tab_title": {
                "type": "string",
                "description": "Title of the tracked tab"
              },
              "capture_logs": {
                "type": "boolean",
                "description": "Whether console log capture is enabled"
              },
              "capture_network": {
                "type": "boolean",
                "description": "Whether network capture is enabled"
              },
              "capture_websocket": {
                "type": "boolean",
                "description": "Whether WebSocket capture is enabled"
              },
              "capture_actions": {
                "type": "boolean",
                "description": "Whether user action capture is enabled"
              }
            }
          },
          "last_command_ack": {
            "type": "string",
            "description": "ID of the last command acknowledged by the extension (for delivery tracking)"
          },
          "extension_logs": {
            "type": "array",
            "description": "Internal extension debug logs for server-side troubleshooting",
            "items": {
              "type": "object",
              "properties": {
                "timestamp": {
                  "type": "string",
                  "format": "date-time",
                  "description": "When the log was emitted"
                },
                "level": {
                  "type": "string",
                  "description": "Log level (info, warn, error)"
                },
                "message": {
                  "type": "string",
                  "description": "Log message text"
                },
                "context": {
                  "type": "string",
                  "description": "Source context (e.g. 'background', 'content-script')"
                }
              }
            }
          },
          "command_results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SyncCommandResult"
            },
            "description": "Results from async commands the extension has executed since last sync"
          }
        }
      },
      "SyncResponse": {
        "type": "object",
        "description": "Server-to-extension sync response. Delivers pending commands, capture overrides, and timing for the next poll. This is the downstream half of the bidirectional sync protocol.",
        "x-docs": {
          "doc": "docs/features/sync-endpoint.md"
        },
        "properties": {
          "ack": {
            "type": "boolean",
            "description": "Acknowledgement that the sync request was processed"
          },
          "commands": {
            "type": "array",
            "description": "Pending commands for the extension to execute (DOM queries, screenshots, browser actions)",
            "items": {
              "$ref": "#/components/schemas/PendingQuery"
            }
          },
          "next_poll_ms": {
            "type": "integer",
            "description": "Suggested delay before next sync poll in milliseconds (adaptive based on activity)"
          },
          "server_time": {
            "type": "string",
            "format": "date-time",
            "description": "Server timestamp for clock synchronization"
          },
          "server_version": {
            "type": "string",
            "description": "Server version string for compatibility checks"
          },
          "capture_overrides": {
            "type": "object",
            "description": "Server-side overrides for extension capture settings"
          }
        }
      },
      "SnapshotResponse": {
        "type": "object",
        "description": "Aggregated capture snapshot for CI/testing integration. Contains all telemetry data across buffers with computed statistics. Used by test frameworks to assert on browser behavior during test runs.",
        "x-docs": {
          "feature": "docs/features/feature/ci-infrastructure/"
        },
        "properties": {
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When the snapshot was generated"
          },
          "test_id": {
            "type": "string",
            "description": "Test boundary label if provided in the request"
          },
          "logs": {
            "type": "array",
            "description": "Console log entries captured during the snapshot window",
            "items": {
              "$ref": "#/components/schemas/LogEntry"
            }
          },
          "websocket_events": {
            "type": "array",
            "description": "WebSocket events captured during the snapshot window",
            "items": {
              "$ref": "#/components/schemas/WebSocketEvent"
            }
          },
          "network_bodies": {
            "type": "array",
            "description": "Network request/response bodies captured during the snapshot window",
            "items": {
              "$ref": "#/components/schemas/NetworkBody"
            }
          },
          "enhanced_actions": {
            "type": "array",
            "description": "User interaction events captured during the snapshot window",
            "items": {
              "$ref": "#/components/schemas/EnhancedAction"
            }
          },
          "stats": {
            "type": "object",
            "description": "Computed statistics across all captured telemetry",
            "properties": {
              "total_logs": {
                "type": "integer",
                "description": "Total log entries in the snapshot"
              },
              "error_count": {
                "type": "integer",
                "description": "Number of error-level logs"
              },
              "warning_count": {
                "type": "integer",
                "description": "Number of warning-level logs"
              },
              "network_failures": {
                "type": "integer",
                "description": "Number of failed network requests (status >= 400)"
              },
              "ws_connections": {
                "type": "integer",
                "description": "Number of distinct WebSocket connections"
              }
            }
          }
        }
      },
      "UploadStageResponse": {
        "type": "object",
        "description": "Response from file upload automation endpoints (Stages 1-4). Contains success/failure status, the stage that produced the result, and optional progress metrics for large file uploads. On failure, includes escalation_reason and suggestions for the next stage to try.",
        "x-docs": {
          "feature": "docs/features/file-upload/"
        },
        "properties": {
          "success": {
            "type": "boolean",
            "description": "Whether the upload stage completed successfully"
          },
          "stage": {
            "type": "integer",
            "description": "Upload pipeline stage number (1-4)"
          },
          "status": {
            "type": "string",
            "description": "Human-readable status message"
          },
          "error": {
            "type": "string",
            "description": "Error message on failure"
          },
          "file_name": {
            "type": "string",
            "description": "Name of the file being uploaded"
          },
          "file_size_bytes": {
            "type": "integer",
            "format": "int64",
            "description": "File size in bytes"
          },
          "duration_ms": {
            "type": "integer",
            "format": "int64",
            "description": "Stage execution time in milliseconds"
          },
          "escalation_reason": {
            "type": "string",
            "description": "Why this stage failed and the next stage should be tried"
          },
          "suggestions": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Suggested next steps or alternative approaches"
          },
          "bytes_sent": {
            "type": "integer",
            "format": "int64",
            "description": "Bytes uploaded so far (for progress tracking)"
          },
          "total_bytes": {
            "type": "integer",
            "format": "int64",
            "description": "Total bytes to upload"
          },
          "percent": {
            "type": "number",
            "description": "Upload progress percentage (0-100)"
          },
          "eta_seconds": {
            "type": "integer",
            "description": "Estimated seconds remaining"
          },
          "speed_mbps": {
            "type": "number",
            "description": "Current upload speed in megabits per second"
          }
        }
      },
      "SyncCommandResult": {
        "type": "object",
        "description": "Result of an async command returned by the extension via the /sync endpoint's command_results field. Structurally identical to AsyncCommandResult but delivered inline with the sync payload instead of via POST /query-result.",
        "x-docs": {
          "core": "docs/core/async-command-api.yaml"
        },
        "properties": {
          "id": {
            "type": "string",
            "description": "Query ID matching the original PendingQuery"
          },
          "correlation_id": {
            "type": "string",
            "description": "Links back to the originating MCP tool call"
          },
          "status": {
            "type": "string",
            "enum": [
              "complete",
              "error",
              "timeout"
            ],
            "description": "Execution outcome"
          },
          "result": {
            "description": "Command result data on success"
          },
          "error": {
            "type": "string",
            "description": "Error message when status is 'error'"
          }
        },
        "required": [
          "id",
          "status"
        ]
      },
      "ExtensionStatus": {
        "type": "object",
        "description": "Extension connection status snapshot. Represents the Chrome extension's current tracking state as reported in sync payloads. Used internally by the server to track extension connectivity.",
        "properties": {
          "type": {
            "type": "string",
            "example": "status",
            "description": "Always 'status' for this message type"
          },
          "tracking_enabled": {
            "type": "boolean",
            "description": "Whether tab tracking is active"
          },
          "tracked_tab_id": {
            "type": "integer",
            "description": "Chrome tab ID being tracked"
          },
          "tracked_tab_url": {
            "type": "string",
            "description": "URL of the tracked tab"
          },
          "extension_connected": {
            "type": "boolean",
            "description": "Whether the extension WebSocket is connected"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When this status was captured"
          }
        }
      }
    }
  }
}
