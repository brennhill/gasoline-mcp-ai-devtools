#!/usr/bin/env node

// bin/gasoline — Cross-platform launcher for the gasoline binary.
// npm's bin field points here. Works on Unix (via shebang) and Windows (via node).

const { execFileSync } = require('child_process')
const path = require('path')
const fs = require('fs')

const platform = { darwin: 'darwin', linux: 'linux', win32: 'win32' }[process.platform]
const arch = { x64: 'x64', arm64: 'arm64' }[process.arch]

if (!platform || !arch) {
  console.error(`Unsupported platform: ${process.platform}-${process.arch}`)
  process.exit(1)
}

const ext = process.platform === 'win32' ? '.exe' : ''
const binaryName = `gasoline-${platform}-${arch}${ext}`
const binaryPath = path.join(__dirname, binaryName)

if (!fs.existsSync(binaryPath)) {
  console.error(`Binary not found: ${binaryPath}`)
  console.error('Run "npm install gasoline-mcp" to download the binary for your platform.')
  process.exit(1)
}

try {
  const result = execFileSync(binaryPath, process.argv.slice(2), {
    stdio: 'inherit',
    windowsHide: false
  })
} catch (e) {
  // execFileSync throws on non-zero exit — forward the exit code
  process.exit(e.status ?? 1)
}
